---
title: "Weather Impact in Health and Economics"
author: "DataScienceGB"
date: "17/06/2015"
output: html_document
---

##Synopsis

Must human activities, varing from leasure such as vacations and picnics to public health and economics  are affected by weather conditions. But, how big is its impact in terms of money and people healthness?

We'll review the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database to picture out Weather's impact on humans injuries and fatalities and the economic damage caused to properties and crops.


##Data Processing

Data used for this analysis is taken directly from [Coursera Reproducible Research Assesment Data](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2)

We'll be using sqldf package to manipulate data  as long with classical R vector manipulation to  set data ready for our anlysis

```{r LibraryLoad}
library(sqldf)
library(xtable)
library(ggplot2)
```

First we'll load data into a dataframe to work with it. 
The following code download and load the requiered data.  

```{r DataLoad}
## Check for file existance
## if exists then load it else
## if not exists bring it from source, inflate it and load it
## Note that read.csv function, inflates and reads data at the same time


bz2_storm_file="./data/repdata_data_StormData.csv.bz2"

if (file.exists(bz2_storm_file) ) {
  stormdf=read.csv(bz2_storm_file,stringsAsFactors=F)
} else { if (!file.exists(bz2_storm_file)) {
       fileUrl<-"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
       download.file(fileUrl,dest=bz2_storm_file,method="curl")
       stormdf=read.csv(bz2_storm_file,stringsAsFactors=F)     
       }
}

dim(stormdf)

```

NOAA storm database, uses a code to specify economic impact in order of magnitude. Since report value is in different magnitudes, we need first to set all to the same scale using the following conversion table:

 |NOAA Code|Conversion Value  |
 |---------|------------------|
 |    K    |    1,000         |
 |    M    |    1,000,000     |
 |    B    |    1,000,000,000 |

For the sake of easyness, we'll convert non documented codes using a value of 1 (one) and assume lower case codes are equivalent to ther upper case codes.

Once data is equalizzed, we can then multiply the scale by the property or crop damage to obtain its value in USD.


```{r convert damage to USD}
#Convert PROPDMG and CROPDMG to same "scale"(usd)
stormdf[!(stormdf$PROPDMGEXP %in% c("b","B","k","K","m","M")),"PROPDMGEXP"] = "1"
stormdf[stormdf$PROPDMGEXP %in% c("k","K"),"PROPDMGEXP"] = "1000"
stormdf[stormdf$PROPDMGEXP %in% c("m","M"),"PROPDMGEXP"] = "1000000"
stormdf[stormdf$PROPDMGEXP %in% c("b","B"),"PROPDMGEXP"] = "1000000000"

stormdf[!(stormdf$CROPDMGEXP %in% c("b","B","k","K","m","M")),"CROPDMGEXP"] = "1"
stormdf[stormdf$CROPDMGEXP %in% c("k","K"),"CROPDMGEXP"] = "1000"
stormdf[stormdf$CROPDMGEXP %in% c("m","M"),"CROPDMGEXP"] = "1000000"
stormdf[stormdf$CROPDMGEXP %in% c("b","B"),"CROPDMGEXP"] = "1000000000"

#Convert Strings to Numeric values
stormdf$PROPDMGEXP=as.numeric(stormdf$PROPDMGEXP)
stormdf$CROPDMGEXP=as.numeric(stormdf$CROPDMGEXP)

#Summarize Data to prepare for results

#summarize health_impact by event type
health_grp=sqldf("select EVTYPE,count(*) as N, sum(FATALITIES+INJURIES) as total_impact,
                   avg(FATALITIES+INJURIES) as impact_by_event 
                  from stormdf
                  where (FATALITIES+INJURIES)!='NA'
                  group by EVTYPE
                  order by 3 desc limit 10")

##

```

## Results

Now we are going to get our first results, to do it, we'll first summarize "fatalities and ijuries" by EVTYPE so we can realize the impact of an atmospheric event in human health.

``` {r PublicHealthImapct}


summary(health_grp)

##print(xtable(health_grp))
health_grp

```

As we can see by our summary data, TORNADOS have the higher impact to public health, their impact almost dobules then the total impact of the rest of the higher impact events. 

>>Attention must be placed into HEAT related events  (EXCESSIVE HEAT and HEAT), eventhough their total impact is almost 10 times less than TORNADOS, they represent the higher impact by event, meaning that each time a HEAT relanted EVTYPE is presented we'll expect almost 6 times more impact  than a TORNADO. **





 
